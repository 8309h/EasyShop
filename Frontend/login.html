<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>

    <link rel="stylesheet" href="style/login.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

    <nav>
        <div id="black2">Download our shop bags mobile app and your membership will extend by three months</div>

        <div id="nav1">
            <div id="logoapp">
                <a href="./index.html"><img src="./images/logo2.png" alt=""></a>
            </div>

            <div id="links">
                <a href="./product.html"><button>WOMEN</button></a>
                <a href="./product.html"><button>MEN</button></a>
                <a href="./aboutus.html"><button>ABOUT</button></a>
                <a href="./product.html"><button>KIDS</button></a>
                <a href="./product.html"><button>HOME</button></a>
                <a href="./product.html"><button>DESIGNERS</button></a>
                <a href="./product.html"><button>COMMUNITY</button></a>
                <a href="./product.html"><button>SALE</button></a>
            </div>
        </div>
    </nav>

    <div id="container">

        <div id="black">
            <div id="logo">
                <img src="./images/logo2.png" alt="">
            </div>
            <h1>We are your <br>Shopping Assistance</h1>
            <p>WITH US YOU CAN</p>
            <h3>üëúCOMPARE WITH 500+ STORE</h3>
            <h3>‚è∞GET ALERTS ON YOUR ITEMS</h3>
            <h3>üîéSAVE YOUR SEARCHES</h3>
            <h3>üõíMANAGE YOUR SHOPPING LIST</h3>
            <h3>ü§ëEARN POINTS</h3>
        </div>

        <div id="white">
            <button id="hide" style="text-align:end; font-size:25px;" onclick="window.location.href='index.html'">‚úñ</button>

            <form id="loginForm">
                <h1>Log in to your account</h1><br>

                <label for="email">E-mail</label><br>
                <input id="email" type="email" placeholder="Enter your email" required><br>

                <label for="password">Password</label><br>
                <div style="position: relative;">
                    <input type="password" id="password" minlength="4" placeholder="Enter password" required>
                    <span id="eye"
                        style="position:absolute; top:50%; right:10px; transform:translateY(-50%); cursor:pointer;"
                        onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
                </div>

                <input type="submit" value="Submit">

                <h3>Do not have an account?
                    <a style="text-decoration:none; color:black;" href="signup.html">Sign-up</a>
                </h3>
            </form>
        </div>
    </div>

    <!-- LOGIN JS CODE -->
    <script>
        const BASE_URL = "http://localhost:8080";

        // Form submit listener
        document.getElementById("loginForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();

            if (!email || !password) {
                return Swal.fire({
                    icon: "warning",
                    title: "All Fields Required",
                    showConfirmButton: false,
                    timer: 1500
                });
            }

            try {
                const response = await fetch(`${BASE_URL}/api/users/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                console.log("Login Response ‚Üí", data);

                if (data.msg === "Login successful") {

                    localStorage.setItem("token", data.token);
                    localStorage.setItem("refreshToken", data.refreshToken);
                    localStorage.setItem("login_user", JSON.stringify(data.user));

                    Swal.fire({
                        icon: "success",
                        title: "Login Successful",
                        showConfirmButton: false,
                        timer: 1500
                    });

                    return setTimeout(() => {
                        window.location.href = "index.html";
                    }, 1500);
                }

                Swal.fire({
                    icon: "error",
                    title: data.msg || "Invalid Credentials",
                    showConfirmButton: false,
                    timer: 2000
                });

            } catch (error) {
                console.error("Login error ‚Üí", error);
                Swal.fire({
                    icon: "error",
                    title: "Server Error",
                    showConfirmButton: false,
                    timer: 1500
                });
            }
        });

        // Toggle password
        function togglePasswordVisibility() {
            const pass = document.getElementById("password");
            const eye = document.getElementById("eye");

            if (pass.type === "password") {
                pass.type = "text";
                eye.textContent = "üëÅÔ∏è";
            } else {
                pass.type = "password";
                eye.textContent = "üîí";
            }
        }
    </script>

</body>
</html>
